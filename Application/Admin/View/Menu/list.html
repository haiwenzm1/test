<extend name="Public/base" />

<block name="css">
    <!--ios7-->
    <link rel="stylesheet" type="text/css" href="/Public/AdminEx/js/ios-switch/switchery.css" />
    <!--icheck-->
    <link rel="stylesheet" type="text/css" href="/Public/AdminEx/js/iCheck/skins/flat/green.css" />
</block>

<block name="style">
    #content ul {
        list-style:none;
        position:relative;
        padding-left:40px;
    }

    .last{
        list-style:none;
    }

    #content li:hover{
        background:#eff0f4;
    }

    #content ul a{
       padding-left:0;
    }

    #content li+ul{
       display:none;
    }

    #content ul:before {
        width: 1px;
        z-index:1;
        display:block;
        content:"";
        position:absolute;
        top:0;
        bottom:0;
        border-left:1px dotted #666;
    }

    #content li:before {
        display:inline-block;
        content:"";
        width:30px;
        height:0;
        border-top:1px dotted #666;
        z-index:1;
        vertical-align:middle;
    }
</block>

<block name="body">
    <div class="row">
        <div class="col-md-12">
            <section class="panel">
                <header class="panel-heading">
                    <button class="btn btn-info" type="button">新增</button>
                    <button class="btn btn-success" type="button">启用</button>
                    <button class="btn btn-primary" type="button">禁用</button>
                    <button class="btn btn-danger" type="button">删除</button>
                </header>
            </section>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <section class="panel">
                <header class="panel-heading">
                    <a class="btn btn-link fullClick">全选</a>|<a class="btn btn-link nofullClick">取消全选</a>
                </header>
                <div class="panel-body" id="content">
                </div>
            </section>
        </div>
    </div>
</block>

<block name="js">
    <!--ios7-->
    <script src="/Public/AdminEx/js/ios-switch/switchery.js"></script>
    <script src="/Public/AdminEx/js/ios-switch/ios-init.js"></script>
    <!--icheck -->
    <script src="/Public/AdminEx/js/iCheck/jquery.icheck.js"></script>
</block>

<block name="script">
$(function () {
    var fuc = {
        config: {
            htmlStr: ''
        },
        init: function () {
            this.renderTable();
            this.bindEvent();
        },
        handleData: function (data) {
            if (data) {
                var that = this;
                that.config.htmlStr += '<ul>';
                for (var i = 0; i < data.length; i++) {
                    if (parseInt(data[i]['is_last'])) {
                        that.config.htmlStr += '<li class="clearfix last">';
                        that.config.htmlStr += '<a class="btn a_checkbox" href="javascript:;"><input type="checkbox" name="auth" value="' + parseInt(data[i]['id']) + '" />&nbsp;' + data[i]['name'] + '</a>';
                        that.config.htmlStr += '<a class="btn btn-link pull-right">' + (parseInt(data[i]['status']) ? '禁用' : '启用') + '</a>';
                    } else {
                        that.config.htmlStr += '<li class="clearfix"><a class="btn switchClick" href="javascript:;"><i class="fa fa-folder"></i>&nbsp;' + data[i]['name'] + '</a>';
                        that.config.htmlStr += '<a class="btn btn-link pull-right addClick">增加</a>';
                    }
                    if (parseInt(data[i]['pid'])) {
                        that.config.htmlStr += '<a class="btn btn-link pull-right deleteClick">删除</a>';
                        that.config.htmlStr += '<a class="btn btn-link pull-right editClick">编辑</a>';
                    }
                    that.config.htmlStr += '<input type="hidden" name="id" value="' + parseInt(data[i]['id']) + '">';
                    that.config.htmlStr += '</li>';

                    if (data[i]['list']) {
                        that.handleData(data[i]['list']);
                    }else{
                        that.config.htmlStr += '<ul><li>还没有内容，快去添加吧</li></ul>';
                    }
                }
                that.config.htmlStr += '</ul>';
                return that.config.htmlStr;
            }
        },
        bindEvent: function () {
            var that = this;

            $(document).on('click', '.a_checkbox', function () {
                $(this).find('[type=checkbox]').prop('checked', !$(this).find('[type=checkbox]').prop('checked'));
            });

            $(document).on('click', '.switchClick', function () {
                if($(this).parent().next('ul')[0]){
                    if($(this).parent().next('ul').is(":hidden")){
                        $(this).parent().next('ul').show().siblings('ul').hide();
                    }else{
                        $(this).parent().next('ul').hide();
                    }
                }else{
                    $(this).parent().siblings('ul').hide();
                }
                $(this).parent().siblings('ul').find('[type=checkbox]').prop('checked', false);
            });

            $(document).on('click', '.fullClick', function () {
                $("#content").find('[type=checkbox]').prop('checked', true);
                $("#content").find('ul').show();
            });

            $(document).on('click', '.nofullClick', function () {
                $("#content").find('[type=checkbox]').prop('checked', false);
                $("#content").find('ul').eq(0).find('ul').hide();
            });

            $(document).on('click', '.deleteClick', function () {
                alert($(this).parent().find('[name=id]').val());
            });

            $(document).on('click', '.addClick', function () {
                $('#masklayerbg').empty().show();
                $('#masklayershow').empty().show();
            });

            $(document).on('click', '.cancleClick', function () {
                $('#masklayershow').empty().hide();
                $('#masklayerbg').empty().hide();
            });

            $(document).on('click', '#masklayerbg', function () {
                $('#masklayershow').empty().hide();
                $('#masklayerbg').empty().hide();
            });
        },
        renderTable: function () {
            var that = this;
            $.ajax({
                type: "post",
                url: "{:U('getAllInfo')}",
                success: function (data) {
                    if (data.info.length) {
                        var html = that.handleData(data.info);
                        html += '<div id="masklayerbg" style="display: none; position: fixed; top: 0%;  left: 0%; width: 100%; height: 100%; background-color: #777; z-index:1001; -moz-opacity: 0.7; opacity:.70; filter: alpha(opacity=70);"></div>';
                        html += '<div id="masklayershow" style="display: none; position: fixed; top: 1%; left: 22%; width: 56%; height: 98%; z-index:1002; background-color: #fff; overflow: auto;"></div>';
                        $('#content').empty().append(html);
                    }
                }
            })
        }
    }

    fuc.init();
});
</block>