<extend name="Public/base" />

<block name="body">
    <div class="row">
        <div class="col-md-12">
            <section class="panel">
                <header class="panel-heading">
                    <a href="javascript:window.history.go(-1);" class="btn btn-link">排序</a>
                    <if condition="$id">
                        <a href="javascript:window.history.go(-1);" class="btn btn-link pull-right">返回</a>
                    </if>
                </header>
                <div class="panel-body">
                    <table class="table table-bordered text-center">
                        <tr>
                            <td><input type="checkbox" class="fullClick"></td>
                            <td>ID</td>
                            <td>名称</td>
                            <td>链接</td>
                            <td>描述</td>
                            <td>排序</td>
                            <td>隐藏</td>
                            <td>状态</td>
                            <td>操作</td>
                        </tr>
                        <notempty name="data">
                            <volist name="data" id="info">
                                <tr>
                                    <td>
                                        <if condition="$info.is_last eq 0">
                                            <input type="checkbox" name="id" disabled="disabled" value="{$info.id}">
                                            <else />
                                            <input type="checkbox" name="id" class="lastmenu" value="{$info.id}">
                                        </if>
                                    </td>
                                    <td>{$info.id}</td>
                                    <td>
                                        <if condition="$info.is_last eq 0"><a href="{:U('index', array('pid' => $info['id']))}" class="switchClick">{$info.name}</a>
                                            <else />{$info.name}</if>
                                    </td>
                                    <td>{$info.url}</td>
                                    <td>{$info.description}</td>
                                    <td>{$info.sort}</td>
                                    <td>
                                        <if condition="$info.is_hide eq 1"> 是
                                            <else /> 否
                                        </if>
                                    </td>
                                    <td>
                                        <if condition="$info.status eq 1"> 正常
                                            <else /> 禁止
                                        </if>
                                    </td>
                                    <td>
                                        <a href="{:U('edit',array('id'=>$info['id']))}" class="text-primary">编辑</a>
                                        <if condition="$info['pid'] neq 0">
                                            <a href="javascript:;" class="text-primary">删除</a>
                                        </if>
                                        <a href="javascript:;" class="text-primary">隐藏</a>
                                    </td>
                                </tr>
                            </volist>
                        </notempty>
                    </table>
                </div>
            </section>
        </div>
    </div>
</block>

<block name="script">
    <script type="text/javascript">
        $(function(){
            $(document).on('click', '.fullClick', function () {
                $('.lastmenu').prop('checked', $(this).prop('checked'));
            });

            $(document).on('click','.deleteClick',function(){
                $(e).attr('disabled', true);
                $.ajax({
                    type: 'post',
                    data: { id: $(e).parent().find('[name=id]').val(), version: $(e).parent().find('[name=version]').val() },
                    url: "{:U('deleteInfoById')}",
                    cache: false,
                    success: function (data) {
                        $(e).attr('disabled', false);
                        alert(data.info);
                        if (data.status) {
                            that.renderTable();
                        }
                    },
                    error: function () {
                        alert("网络出错,请重试");
                    }
                });
            });
        });
    </script>
</block>